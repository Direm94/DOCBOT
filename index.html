<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>School Chatbot Ilimitado</title>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
  <style>
    /* [Pega aquí TODO el CSS de tu código original] */
  </style>
</head>
<body>

  <!-- Pantalla de bloqueo -->
  <div class="lock-screen" id="lockScreen">
    <div class="lock-screen-content">
      <h2>Welcome to English Chatbot</h2>
      <p>Please enter your name to start</p>
      <input type="text" id="userNameInput" placeholder="Your full name" autofocus>
      <button onclick="registerUser()">Continue</button>
    </div>
  </div>

  <!-- Contenido principal -->
  <div class="main-content" id="mainContent">
    <div class="header-container">
      <img src="https://i.postimg.cc/GpkMdTmx/is.png" alt="Left Logo" class="header-logo">
      <div class="header-center">
        <h1 class="welcome-title">Welcome, <span id="welcomeUserName"></span>!</h1>
      </div>
      <img src="https://i.postimg.cc/8C5rrQH2/logo-2.png" alt="Right Logo" class="header-logo">
    </div>

    <div class="main-container">
      <div class="chatbot-column">
        <!-- Chatbot autoalojado -->
        <iframe 
          id="chatbotFrame"
          src="https://TU-BOTPRESS-EN-RENDER.com/webchat/"
          allow="microphone; camera">
        </iframe>
      </div>

      <div class="comments-section">
        <h3>Live Comments</h3>
        <div class="comments-list" id="commentsList"></div>
        <div class="comment-input">
          <input type="text" id="commentName" placeholder="Your name (optional)">
          <textarea id="commentInput" placeholder="Write your comment..."></textarea>
          <button onclick="postComment()">Send Comment</button>
        </div>
      </div>
    </div>

    <footer>
      Created by: <strong>English Team</strong> | Chatbot 100% Ilimitado
    </footer>
  </div>

  <script>
    // Configuración Firebase (Reemplaza con tus datos)
    const firebaseConfig = {
      apiKey: "AIzaSyABCDEFGHIJKLMNOPQRSTUVWXYZ12345678",
      authDomain: "tuchatbot-ilimitado.firebaseapp.com",
      projectId: "tuchatbot-ilimitado",
      storageBucket: "tuchatbot-ilimitado.appspot.com",
      messagingSenderId: "123456789012",
      appId: "1:123456789012:web:abcdefghijklmnopqrstuv"
    };

    // Inicializar Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Sistema de usuarios
    function registerUser() {
      const name = document.getElementById('userNameInput').value.trim();
      if (!name) return alert("Please enter your name");
      
      localStorage.setItem("userName", name);
      unlockApp(name);
    }

    function unlockApp(name) {
      document.getElementById('lockScreen').style.display = 'none';
      document.getElementById('mainContent').style.display = 'block';
      document.getElementById('welcomeUserName').textContent = name;
      document.getElementById('commentName').value = name;
      loadComments();
    }

    // Comentarios con Firebase
    function loadComments() {
      db.collection("comments")
        .orderBy("timestamp", "desc")
        .limit(50)
        .onSnapshot(snapshot => {
          const commentsList = document.getElementById('commentsList');
          commentsList.innerHTML = '';
          
          snapshot.forEach(doc => {
            const comment = doc.data();
            const commentDiv = document.createElement('div');
            commentDiv.className = 'comment';
            commentDiv.innerHTML = `
              <strong>${comment.user}:</strong> 
              <span>${comment.text}</span>
              <small>${new Date(comment.timestamp?.toDate()).toLocaleString()}</small>
            `;
            commentsList.appendChild(commentDiv);
          });
        });
    }

    function postComment() {
      const user = document.getElementById('commentName').value.trim() || 'Anonymous';
      const text = document.getElementById('commentInput').value.trim();
      if (!text) return;

      db.collection("comments").add({
        user,
        text,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });

      document.getElementById('commentInput').value = '';
    }

    // Inicialización
    document.addEventListener('DOMContentLoaded', () => {
      const savedName = localStorage.getItem("userName");
      if (savedName) unlockApp(savedName);
    });
  </script>
</body>
</html>
